# 비디오 코덱과 압축

## 비디오란 ?
- 비디오는 이미지의 모음이다. 프레임에 사진을 하나씩 가지고 있다.
- 비디오를 저장하기 위해서는 한 픽셀에 3바이트(Red, green, blue)의 데이터가 저장이 되어 있어야 한다.

- 비교적 낮은 해상도 (640 x 480 픽셀)의 비디오를 초당 25 프레임으로 저장하려면 
- 3 * 640 * 480 *25 바이트의 메모리가 필요하며 이는 초당 23MB 에 해당 한다.
- 보통 비디오에는 1초에 24 ~ 60 프레임이 담겨 있다

## 비디오 인코딩?
![video encoding](http://www.ktword.co.kr/img_data/978_2.JPG)
- 아날로그 신호는 표본화(Sampling) -> 양자화(Quantization) -> 부호화(Coding) 을 거친다 
- 표본화 : 아날로그 신호의 순간적인 값을 취한다.
- 양자화 : 표본화를 통해 쪼개진 값을 진폭에 따라 대표값으로(적분) 변환 한다.
- 부호화 : 1,0으로 변환한다.


## 비디오의 압축 ?
- 무손실 압축 : zip, tar.gz
- 비디오에서는 모손실 압축 방법으로는 제한이 있다. 용량이 너무 크기 때문에 손실 압축 방식을 사용한다.

- 사람은 간세포(밝기감기)와 추세포(색상감지) 두가지 수용채가 있다. 간세포가 추세포보다 민감해서 어둠속에서도 색상이 아니라 형상을 더 잘 인식하게 된다. 
- 코덱에서 밝기와 색상을 다르게 처리하기 위해 각 픽셀을 RGB(Red, green, blue) -> YCbCr 로 변환한다.

- YCrCb : 각 픽셀의 밝기에 해당하는 Y (휘도), 파란색을 표현하는 Cb, 빨간색 농도를 표현하는 Cr(채도) 로 이루어져 있다.
- 각 3가지 채널로 변경하면서 색상과 밝기를 분리할수 있다.

- Y = 0.257R + 0.504G + 0.098B + 16
- Cr = 0.439R - 0.368G - 0.071B + 128
- Cb = -0.148R - 0.219G + 0.439B + 128

## 코덱(codec = coder + decoder)
파일의 용량을 줄이면서 디코딩된 비디오의 품질을 최대한 높게 유지하기 위하여 압축 기술이 발전했다. 

### h261
- 최초의 압축 방법

### MPEG-1
1. chroma subsampling : 사람이 감지하기 힘든 채도(Cb, Cr) 채널 정보는 수직 수평 해상도가 각 반으로 줄여서 1/4로 줄어들고 전체적으로 (1 + 1/4 + 1/4) 가 된다.
2. 프레임 기술
비디오의 각 프레임의 앞뒤는 전혀 다르지 않고 거의 유사한 정보를 담고 있기 때문에 이 프레임의 특성을 이용한다.
- I(intra) 프레임 : 이 압축 기술은 JPEG 처럼 이미지를 작게 유지하는 것과 유사한 기술이다. 
YUV 를 8x8 블록으로 분할하여 Cb, Cr 은 서브샘플링이 되어있으므로 (4개의 Y, 1개의 Cr, 1개의 Cb) 총 6개의 8x8 매크로블록을 만든다.
- P(predicted) 프레임 : 전체 이미지가 아닌 변화된 부분만을 이용한다. 
이전의 I 혹은 P 프레임을 참조하여 비슷한 메크로 블록을 찾고(모션 검색) 
찾게 되면 처음부터 모든 메크로 블록을 인코딩 하지 않고 일치하는 항목의 모션 벡터를 인코딩한다. 
찾지 못한다면 I 프레임과 동일한 방식으로 메크로 블록을 저장한다. </br>
약간의 작은 차이가 있을수 있는데 이를 예측 오차, 잔차(residual)이라한다. 이런 중간의 누락된 픽셀 값을 생성하는 체계가 보간(interpolation) 이라 한다. 보통 두지점의 선형값을 대표값으로 취하는 방식(linear interplication)을 이용한다.
- B(bi-directional) 프레임 : 앞뒤의 I,P프레임 요소를 표현한다. 이때 프레임간의 재정렬(GOP 집합)이 필요하다.  

3. 주파수 변환
사람눈은 미세한(고주파) 변화보다는 거친(저주파) 변화를 더 쉽게 감지하는 특성을 이용한다.
매크로블록을 구성하는 4개의 8x8 휘도 블록과 2개의 8x8 채도 블록에 각각 이산 코사인(DCT) 변환을 수행한다. 

4. 그외
- 차동 펄스 코드 변조 : 마지막 값과 현재값의 차이만 저장한다. 차이만 저장하면 분포가 원래의 분포보다 더 가파르게 되므로 응답성이 향상된다.
- RLE : 양자화 레벨이 높을수록 지그재그 패턴으로 같은값이 연속해서 많이 나오면 그 갯수만을 표기한다.
- 허프만 코딩 : 연속적인 중복 데이터를 제거하여 공간을 절약한다.

### MPEG-2 ( = H.262)
MPEG-1에서 2개의 오디오 채널(스테레오)를 지원하지만 서라운드 사운드는 지원하지 못하였던 점을 극복하였다.

### 현재
현재는 MPEG-4, H.264 버전을 많이 사용한다. 최근 H.265 기술이 나왔다.

### 





