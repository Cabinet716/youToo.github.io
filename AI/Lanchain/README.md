# Lanchain 구성

## 스키마
- 텍스트(Text) : 언어모델과의 인터페이스는 주로 텍스트, 랭체인 또한 주요 인터페이스가 텍스트
- 채팅메세지(ChatMessages) : 채팅 인터페이스에서 사용하는 메세지
    - 시스템 채팅 메세지(SystemChatMessage) : AI 시스템에 대한 지시 사항
    - 사용자 채팅 메세지(HumanChatMessage) : 사용자 입력 정보
    - AI 채팅 메세지(AiChatMessage) : AI 시스템 출력 메세지
- 예시(Examples) : 함수에 대한 입력과 예상되는 출력을 나타내는 입력/출력 쌍이며, 모델의 훈련과 평가에 사용될수 있음. 또한 모델 또는 체인에 대한 입력/출력이 될수 있음. 모델인 경우 모델을 미세조정하는데 사용.
- 문서(Document) : 비구조화된 데이터 조각이며, Page_content(데이터내용)과 Metadata(데이터 속성을 설명하는 부가정보)로 이루어짐

## 모델
https://python.langchain.com/en/latest/modules/models.html
- 텍스트 문자열 -> 대규모 언어 모델 LLMs -> 텍스트 문자열
- 채팅 메세지 목록 -> 채팅 모델 -> 채팅 메세지
- 텍스트 입력 -> 텍스트 임베딜 모델 -> 실수 목록

## 프롬프트
- Prompt Value : 모델에 대한 입력을 나타내는 클래스
- Prompt Template : Prompt value를 구성하는 클래스
- Example Selectors : 프롬프트에 예시를 포함
- Output Parsers : 텍스트로만 변환하는 것보다 더 구조화된 정보를 얻고 싶을때 (모델에 대한 출력 형식 지시, 원하는 포멧으로 출력을 파싱, 다시시도)

## 인덱스
- Document loaders : 언어 모델과 사용자의 텍스트 데이터를 결합하는 방법 중 하나로 "문서"에서 텍스트 조각으로 로드. Unstructured 패키지를 사용하여 텍스트, 파워포인트, 이미지, HTML,PDF 등 모든 유형의 파일을 텍스트 데이터로 변환함
- Text Splitters : 긴텍스트를 처리하려면 여러조각으로 나누는데 의미론적인 텍스트 조각을 함께 유지
- Vector Stores : 입력 텍스트를 임베딩을 통해 벡터로 생성하고, 생성된 벡터를 저장/관리/검색 할 수 있는 기능을 제공하는 저장소
- Retrievers : 인터페이스는 문서를 언어 모델과 결합하기 쉽게 하는 일반적인 인터페이스. 쿼리(문자열)를 입력 받고 문서 목록을 반환하는 get_relevant_documents 메서드를 제공

## 메모리
- 단기메모리, 장기메모리
- 채팅 메세지 히스토리 : 이전에 모든 채팅 상호작용을 기억하는 역할. 이를 모델에 직접 다시 전달하거나 다른 방식으로 요약하거나 두가지를 조합할수 있음
- 입력을 기반으로 데이터 조각을 가져옴 <-> 입출력 기반으로 상태 업데이트

## 체인
- 체인: 여러개별 구성 요소를 둘러싼 종단 간 래퍼(wrapper)
- LLM 체인 : 가장 일반적인 체인, (프롬프트템플릿 + 모델 + 출력 파서)로 구성됨
- 인텍스 연관 체인 : 인덱스에 연관된 고유한 데이터와 LLMdm을 결합하여 인덱스와 상호작용 수행. (ex, 직접 작성한 문서에서 질문에 대한 답변을 찾음)
- 프롬프트 선택자 : 하나의 모델에 잘 작동하는 프롬프트가 다른 모델에는 그렇지 않을수 있어서 전달된 모델에 따라 기본 프롬프트를 선택하는 역할을 함

### 인덱스 연관 체인 (Index-related chains)
- 목적을 달성하기 위해 특정한 방식으로 결합된 모듈식 구성 요소
- 사용자 입력을 받아 적절한 형식으로 구성하고, 모델에 전달하여 응답받고, 모델 출력을 검증하고 필요한 경우 수정할 수 있도록 구성 가능
- 스터핑 : 관련 데이터를 전부 프롬프트에 지문으로 집어넣어 언어모델에 전달 (StuffDocumentsChain으로 구현)
- 맵리튜드 : 
    - 1. 각 데이터 청크에서 초기 프롬프트를 실행
    - 2. 초기 출력을 모두 결합하는데 사용되는 다른 프롬프트 실행
    - 3. MapReduceDocumentsChain 으로 구현
- 리파인: 
    - 1. 첫번째 데이터 청크에서 초기 프롬프트를 실행
    - 2. 나머지 문서에 대해 그 출력과 함께 새 문서를 전달하여 출력을 개선하도록 요청
- 맵-리랭크
    - 1. 각 데이터 청크에서 초기 프롬프트를 실행하여 작업을 완료하고
    - 2. 답변에 대한 확인 수준을 나타내는 점수를 부여
    - 3. 이 점수에 따라 응답 순위를 매겨 가장 높은 점수를  



## 에이전트
